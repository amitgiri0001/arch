define(["angularAMD","routes"],function(e,t){"use strict";function n(e,t,n,r){this.scope=e,this.property=t,this.parameters=n,this._scopeBindings=r,this._ignore=[],this.logLabel="scope"+this.scope.n+"["+this.property+"]"}function r(e,t,i){var o={update:{method:"PUT"}};_.assign(o,i);var a=t(e,{},o);Object.defineProperty(a,"uri",{get:function(){return e}});var s=[];return a.bindScope=function(e,t,r,i){var o=new n(e,t,r,s);s.push(o),o.log("parameters",r),o.log("self.get(...)",e[t]);var u=function(n){o.log("getThen",n),o.unWatch=e.$watch(t,angular.bind(o,o.onWatch),!0)};return o.setValue(i?a.query(r,u):a.get(r,u)),a},a.bindScope1=function(e,t,n){return a.bindScope(e,t,n,!1)},a.bindScopeN=function(e,t,n){return a.bindScope(e,t,n,!0)},a.map=function(n,i,o,s){var u=new r(e+i,t,o);return Object.defineProperty(a,n,{value:u,writable:!1}),s&&angular.bind(u,s)(u),a},a.matchUri=function(t){return e===t},a}n.prototype.log=function(){},n.prototype.isInterested=function(e,t){return-1===this._ignore.indexOf(e)&&angular.equals(t,this.parameters)&&!angular.equals(e,this.getValue())},n.prototype.onWatch=function(e){if(-1===this._ignore.indexOf(e)){this._ignore.push(e);try{this.log("onWatch",e);for(var t=0;t<this._scopeBindings.length;t++){var n=this._scopeBindings[t];if(n!==this&&n.isInterested(e,this.parameters)){this.log("onWatch-update("+n.logLabel+")",e),n._ignore.push(e);try{n.setValue(e)}finally{n._ignore.pop()}}}}finally{this._ignore.pop()}}},n.prototype.getValue=function(){return this.scope[this.property]},n.prototype.setValue=function(e){this.log("setValue",e),this.scope[this.property]=e},e.factory("api",["$resource",function(e){for(var n=new r(t.apiRoot,e),i=[{apiNode:n,value:t.urls}];i.length>0;){var o=i.pop();for(var a in o.value)if(o.value.hasOwnProperty(a)){var s=o.value[a],u={get:{method:"GET",cache:!1}},p="";"string"==typeof s||s instanceof String?(p=s,s=void 0):s instanceof Array&&(p=s[0],s.length>3&&(u=s[3]),s=s.length<3?s[1]:s[2]),o.apiNode.map(a,p,u,function(e){i.push({apiNode:e,value:s})})}}return n}])});
